<div class="admin-attendance-container">
  <h2 class="page-title">Attendance Management</h2>

  <!-- Month/Year Filter -->
  <div class="filters-section">
    <div class="filter-group">
      <label for="year">Year:</label>
      <select id="year" [(ngModel)]="selectedYear" (change)="onMonthYearChange()" class="form-control">
        <option [value]="2024">2024</option>
        <option [value]="2025">2025</option>
        <option [value]="2026">2026</option>
      </select>
    </div>
    <div class="filter-group">
      <label for="month">Month:</label>
      <select id="month" [(ngModel)]="selectedMonth" (change)="onMonthYearChange()" class="form-control">
        <option [value]="1">January</option>
        <option [value]="2">February</option>
        <option [value]="3">March</option>
        <option [value]="4">April</option>
        <option [value]="5">May</option>
        <option [value]="6">June</option>
        <option [value]="7">July</option>
        <option [value]="8">August</option>
        <option [value]="9">September</option>
        <option [value]="10">October</option>
        <option [value]="11">November</option>
        <option [value]="12">December</option>
      </select>
    </div>
  </div>

  @if (loading && !selectedEmployee) {
    <div class="loading">Loading employees...</div>
  } @else {
    <!-- Employee List with Attendance Bars -->
    @if (!selectedEmployee) {
      <div class="employees-section">
        <h3>Employees ({{ allEmployees.length }})</h3>
        
        @if (paginatedEmployees.length === 0) {
          <div class="no-data">No employees found</div>
        } @else {
          <div class="employees-grid">
            @for (emp of paginatedEmployees; track emp.id) {
              <div class="employee-row" (click)="selectEmployee(emp)">
                <div class="employee-info">
                  <div class="employee-name">{{ emp.name }}</div>
                  <div class="employee-position">{{ emp.positionName }}</div>
                </div>
                <div class="attendance-bar-container">
                  @if (emp.stats) {
                    <div class="attendance-bar">
                      <div class="bar-present" 
                           [style.width.%]="getAttendancePercentage(emp.stats)">
                      </div>
                      <div class="bar-absent" 
                           [style.width.%]="100 - getAttendancePercentage(emp.stats)">
                      </div>
                    </div>
                    <span class="attendance-percent">
                      {{ getAttendancePercentage(emp.stats).toFixed(0) }}%
                    </span>
                  } @else {
                    <span class="attendance-loading">Loading...</span>
                  }
                </div>
              </div>
            }
          </div>

          <!-- Pagination -->
          @if (totalPages > 1) {
            <div class="pagination">
              <button 
                class="btn btn-sm btn-secondary" 
                (click)="previousPage()"
                [disabled]="currentPage === 1">
                Previous
              </button>

              @for (page of getPageNumbers(); track page) {
                <button 
                  class="btn btn-sm"
                  [class.btn-primary]="currentPage === page"
                  [class.btn-secondary]="currentPage !== page"
                  (click)="goToPage(page)">
                  {{ page }}
                </button>
              }

              <button 
                class="btn btn-sm btn-secondary" 
                (click)="nextPage()"
                [disabled]="currentPage === totalPages">
                Next
              </button>
            </div>
          }
        }
      </div>
    }

    <!-- Employee Details View -->
    @if (selectedEmployee && employeeStats) {
      <div class="employee-details">
        <button class="btn btn-back" (click)="closeEmployeeDetails()">
          ‚Üê Back to List
        </button>

        <h3>{{ selectedEmployee.name }}</h3>
        <p class="employee-position-detail">{{ selectedEmployee.positionName }}</p>

        <!-- Stats Summary -->
        <div class="stats-summary">
          <div class="stat-card stat-present">
            <div class="stat-label">Present Days</div>
            <div class="stat-value">{{ employeeStats.presentDays }}</div>
          </div>
          <div class="stat-card stat-late">
            <div class="stat-label">Late Days</div>
            <div class="stat-value">{{ employeeStats.lateDays }}</div>
          </div>
          <div class="stat-card stat-absent">
            <div class="stat-label">Absent Days</div>
            <div class="stat-value">{{ employeeStats.absentDays }}</div>
          </div>
          <div class="stat-card stat-leave">
            <div class="stat-label">Leave Days</div>
            <div class="stat-value">{{ employeeStats.leaveDays }}</div>
          </div>
        </div>

        <!-- Attendance Records -->
        <div class="attendance-records">
          <h4>Attendance Records</h4>
          
          @if (employeeAttendance.length === 0) {
            <div class="no-data">No attendance records found for this period</div>
          } @else {
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Clock In</th>
                    <th>Clock Out</th>
                    <th>Work Mode</th>
                    <th>Status</th>
                    <th>Daily Report</th>
                  </tr>
                </thead>
                <tbody>
                  @for (record of employeeAttendance; track record.attendanceId) {
                    <tr>
                      <td>{{ formatDate(record.date) }}</td>
                      <td>{{ formatTime(record.clockIn) }}</td>
                      <td>{{ formatTime(record.clockOut) }}</td>
                      <td>{{ record.workMode || '-' }}</td>
                      <td>
                        <span class="status-badge" [ngClass]="getStatusClass(record.status)">
                          {{ record.status }}
                        </span>
                      </td>
                      <td class="daily-report-cell">
                        {{ record.dailyReport || '-' }}
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          }
        </div>
      </div>
    } @else if (selectedEmployee && loading) {
      <div class="loading">Loading employee details...</div>
    }
  }
</div>

<!-- Message Modal -->
<app-modal
  [show]="showModal"
  [title]="modalTitle"
  [message]="modalMessage"
  (close)="closeModal()">
</app-modal>