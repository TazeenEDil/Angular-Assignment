<div class="attendance-container">
  <h2 class="page-title">My Attendance Records</h2>

  @if (loading) {
    <div class="loading">Loading...</div>
  } @else {
    <!-- Stats Section -->
    @if (stats) {
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value">{{ stats.attendancePercentage.toFixed(1) }}%</div>
          <div class="stat-label">Attendance Rate</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">{{ stats.presentDays }}</div>
          <div class="stat-label">Present Days</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">{{ stats.absentDays }}</div>
          <div class="stat-label">Absent Days</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">{{ stats.lateDays }}</div>
          <div class="stat-label">Late Days</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">{{ stats.leaveDays }}</div>
          <div class="stat-label">Leave Days</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">{{ stats.reportSubmissionRate.toFixed(1) }}%</div>
          <div class="stat-label">Report Submission</div>
        </div>
      </div>
    }

    <!-- Alerts -->
    @if (alerts.length > 0) {
      <div class="alerts-section">
        <h3>Alerts</h3>
        <div class="alerts-list">
          @for (alert of alerts; track alert.alertId) {
            <div class="alert-item" [class.unread]="!alert.isRead" (click)="markAlertAsRead(alert.alertId)">
              <div class="alert-header">
                <span class="alert-type">{{ alert.alertType }}</span>
                <span class="alert-date">{{ formatDate(alert.alertDate) }}</span>
              </div>
              <p class="alert-message">{{ alert.message }}</p>
            </div>
          }
        </div>
      </div>
    }

    <!-- Attendance History -->
    <div class="history-section">
      <h3>Attendance History (Last 30 Days)</h3>
      @if (attendanceRecords.length > 0) {
        <table class="table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Clock In</th>
              <th>Clock Out</th>
              <th>Work Mode</th>
              <th>Total Hours</th>
              <th>Status</th>
              <th>Report</th>
            </tr>
          </thead>
          <tbody>
            @for (record of attendanceRecords; track record.attendanceId) {
              <tr>
                <td>{{ formatDate(record.date) }}</td>
                <td>{{ formatTime(record.clockIn) }}</td>
                <td>{{ formatTime(record.clockOut) }}</td>
                <td>{{ record.workMode }}</td>
                <td>{{ formatDuration(record.totalWorkHours) }}</td>
                <td>
                  <span class="status-badge" [ngClass]="getStatusClass(record.status)">
                    {{ record.status }}
                  </span>
                </td>
                <td>
                  @if (record.dailyReportSubmitted) {
                    <span class="badge badge-success">✓</span>
                  } @else {
                    <span class="badge badge-danger">✗</span>
                  }
                </td>
              </tr>
            }
          </tbody>
        </table>
      } @else {
        <p class="text-muted">No attendance records found</p>
      }
    </div>
  }
</div>

<!-- Message Modal -->
<app-modal
  [show]="showModal"
  [title]="modalTitle"
  [message]="modalMessage"
  (close)="closeModal()">
</app-modal>