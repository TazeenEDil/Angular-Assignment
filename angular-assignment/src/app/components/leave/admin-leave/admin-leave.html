<div class="admin-leave-container">
  <h2 class="page-title">Leave Management</h2>

  @if (loading) {
    <div class="loading">Loading...</div>
  } @else {
    <!-- Pending Leave Requests -->
    <div class="pending-leaves">
      <h3>Pending Leave Requests</h3>
      
      @if (pendingLeaves.length > 0) {
        <table class="table">
          <thead>
            <tr>
              <th>Employee</th>
              <th>Leave Type</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Days</th>
              <th>Reason</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (leave of pendingLeaves; track leave.leaveRequestId) {
              <tr>
                <td>{{ leave.employeeName }}</td>
                <td>{{ leave.leaveTypeName }}</td>
                <td>{{ formatDate(leave.startDate) }}</td>
                <td>{{ formatDate(leave.endDate) }}</td>
                <td>{{ leave.totalDays }}</td>
                <td>{{ leave.reason }}</td>
                <td>
                  <button class="btn btn-sm btn-primary" (click)="openLeaveModal(leave)">
                    Review
                  </button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      } @else {
        <div class="no-data">
          <p>No pending leave requests</p>
        </div>
      }
    </div>
  }
</div>

<!-- Leave Review Modal -->
@if (showLeaveModal && selectedLeave) {
  <div class="modal-backdrop" (click)="!processingLeave && closeLeaveModal()"></div>
  <div class="modal leave-review-modal">
    <div class="modal-dialog" (click)="$event.stopPropagation()">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Review Leave Request</h5>
          <button 
            type="button" 
            class="btn-close" 
            (click)="closeLeaveModal()" 
            [disabled]="processingLeave">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div class="leave-details">
            <div class="detail-row">
              <strong>Employee:</strong>
              <span>{{ selectedLeave.employeeName }}</span>
            </div>
            <div class="detail-row">
              <strong>Leave Type:</strong>
              <span>{{ selectedLeave.leaveTypeName }}</span>
            </div>
            <div class="detail-row">
              <strong>Start Date:</strong>
              <span>{{ formatDate(selectedLeave.startDate) }}</span>
            </div>
            <div class="detail-row">
              <strong>End Date:</strong>
              <span>{{ formatDate(selectedLeave.endDate) }}</span>
            </div>
            <div class="detail-row">
              <strong>Total Days:</strong>
              <span>{{ selectedLeave.totalDays }}</span>
            </div>
            <div class="detail-row">
              <strong>Reason:</strong>
              <span>{{ selectedLeave.reason }}</span>
            </div>
          </div>
          
          <div class="form-group mt-3">
            <label for="rejectionReason">Rejection Reason (Required only if rejecting):</label>
            <textarea 
              id="rejectionReason"
              [(ngModel)]="rejectionReason" 
              class="form-control" 
              rows="3"
              placeholder="Enter reason for rejection..."
              [disabled]="processingLeave">
            </textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button 
            class="btn btn-secondary" 
            (click)="closeLeaveModal()"
            [disabled]="processingLeave">
            Cancel
          </button>
          <button 
            class="btn btn-danger" 
            (click)="rejectLeave()"
            [disabled]="processingLeave">
            @if (processingLeave) {
              <span class="spinner-border spinner-border-sm me-2"></span>
            }
            Reject
          </button>
          <button 
            class="btn btn-success" 
            (click)="approveLeave()"
            [disabled]="processingLeave">
            @if (processingLeave) {
              <span class="spinner-border spinner-border-sm me-2"></span>
            }
            Approve
          </button>
        </div>
      </div>
    </div>
  </div>
}

<!-- Message Modal -->
<app-modal
  [show]="showModal"
  [title]="modalTitle"
  [message]="modalMessage"
  (close)="closeModal()">
</app-modal>